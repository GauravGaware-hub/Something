<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>For Kuttu ğŸ’—</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* Smooth fade utility */
      .fade {
        transition: opacity 0.8s ease;
      }

      /* âœ¨ Universal interactive glow */
      .interactive {
        transition: transform 0.25s ease, box-shadow 0.25s ease,
          filter 0.25s ease;
      }

      .interactive:hover {
        transform: scale(1.08);
        box-shadow: 0 10px 25px rgba(244, 63, 94, 0.45),
          0 0 20px rgba(244, 63, 94, 0.55);
        filter: brightness(1.05);
      }

      .interactive:active {
        transform: scale(1.03);
      }

      /* ğŸŒ™ Dark mood background */
      .dark-mood {
        background: linear-gradient(135deg, #4a1d2f, #7a2e4f, #9f4c6b);
      }
    </style>
  </head>

  <body
    class="w-screen h-screen overflow-hidden bg-gradient-to-br from-pink-300 via-pink-200 to-rose-200 flex items-center justify-center"
  >
    <!-- ğŸµ Background Music -->
    <audio id="bgMusic" loop>
      <source src="assets/music.mp3" type="audio/mpeg" />
    </audio>

    <!-- ğŸŒ¸ Welcome Screen -->
    <section id="welcomeScreen" class="text-center fade">
      <h1 class="text-4xl md:text-5xl font-bold text-rose-800 mb-6">
        Hey Kuttu ğŸ’•
      </h1>

      <p class="text-lg text-rose-700 mb-10">
        I made something special just for you
      </p>

      <button
        id="startBtn"
        class="interactive px-8 py-4 rounded-full bg-rose-500 text-white text-lg font-semibold shadow-xl"
      >
        Let's Start âœ¨
      </button>
    </section>

    <!-- ğŸ¤ Singing Challenge Screen -->
    <section id="singingScreen" class="hidden text-center fade px-6">
      <p class="text-rose-600 mb-2 text-lg">
        First I have a challenge for you ğŸ’«
      </p>

      <h2 class="text-3xl md:text-4xl font-bold text-rose-800 mb-6">
        Sing your favourite song ğŸ¶
      </h2>

      <p class="text-rose-700 mb-10">Donâ€™t worry, thereâ€™s no judging here ğŸ’—</p>

      <!-- Recording Buttons (inactive for now) -->
      <div class="flex flex-col items-center gap-6">
        <button
          id="startRecordingBtn"
          class="interactive px-8 py-4 rounded-full bg-rose-500 text-white text-lg font-semibold shadow-xl"
        >
          Start Recording ğŸ¤
        </button>

        <button
          id="stopRecordingBtn"
          class="interactive px-8 py-4 rounded-full bg-rose-400 text-white text-lg font-semibold shadow-xl hidden"
        >
          Stop Recording â¹ï¸
        </button>
      </div>

      <!-- Awesome text (hidden initially) -->
      <p
        id="awesomeText"
        class="hidden mt-10 text-xl text-rose-800 font-semibold"
      >
        Awesome âœ¨
      </p>

      <!-- Choice Buttons -->
      <div
        id="celebrateChoices"
        class="hidden mt-8 flex flex-col md:flex-row gap-6 justify-center"
      >
        <button
          id="celebrateBtn"
          class="interactive px-8 py-4 rounded-full bg-rose-600 text-white text-lg font-semibold shadow-xl"
        >
          Letâ€™s Celebrate ğŸ‰
        </button>

        <button
          id="noCelebrateBtn"
          class="interactive px-8 py-4 rounded-full bg-gray-300 text-gray-700 text-lg font-semibold shadow-xl relative"
        >
          I donâ€™t wanna ğŸ˜’
        </button>
      </div>
    </section>

    <script>
      let mediaRecorder;
      let audioChunks = [];
      let singingAudios = []; // multiple takes stored here
      let recordingTimeout;
      const startRecBtn = document.getElementById("startRecordingBtn");
      const stopRecBtn = document.getElementById("stopRecordingBtn");
      const awesomeText = document.getElementById("awesomeText");
      const celebrateChoices = document.getElementById("celebrateChoices");
      const startBtn = document.getElementById("startBtn");
      const bgMusic = document.getElementById("bgMusic");

      const welcomeScreen = document.getElementById("welcomeScreen");
      const singingScreen = document.getElementById("singingScreen");

      startBtn.addEventListener("click", async () => {
        if (document.documentElement.requestFullscreen) {
          await document.documentElement.requestFullscreen();
        }

        bgMusic.volume = 0.4;
        bgMusic.play();

        welcomeScreen.classList.add("hidden");
        singingScreen.classList.remove("hidden");

        // ğŸŒ™ Darker mood starts here
        document.body.classList.add("dark-mood");
      });

      startRecBtn.addEventListener("click", async () => {
        audioChunks = [];

        // Pause music
        bgMusic.pause();

        const stream = await navigator.mediaDevices.getUserMedia({
          audio: true,
        });
        mediaRecorder = new MediaRecorder(stream);

        mediaRecorder.start();

        // UI changes
        startRecBtn.classList.add("hidden");
        stopRecBtn.classList.remove("hidden");

        // Collect audio
        mediaRecorder.ondataavailable = (e) => {
          audioChunks.push(e.data);
        };

        // â± Stop automatically after 5 minutes
        recordingTimeout = setTimeout(() => {
          if (mediaRecorder.state === "recording") {
            mediaRecorder.stop();
          }
        }, 5 * 60 * 1000);
      });

      stopRecBtn.addEventListener("click", () => {
        if (!mediaRecorder) return;

        clearTimeout(recordingTimeout);
        mediaRecorder.stop();

        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks, { type: "audio/webm" });
          singingAudios.push(audioBlob); // save take

          // Resume music
          bgMusic.play();

          // UI changes
          stopRecBtn.classList.add("hidden");
          startRecBtn.classList.remove("hidden");

          awesomeText.classList.remove("hidden");
          celebrateChoices.classList.remove("hidden");
        };
      });
    </script>
  </body>
</html>
